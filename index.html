<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWA Manifest Link s-->
    <link rel="manifest" href="manifest.json">
    <!-- Theme color for PWA -->
    <meta name="theme-color" content="#111827"/>
    <title>AI Workout Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .touch-active:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        .progress-bar-inner {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, 
                #a855f7 0%, 
                #ec4899 50%, 
                #f43f5e 100%);
            box-shadow: 
                0 0 20px rgba(168, 85, 247, 0.6),
                0 0 40px rgba(236, 72, 153, 0.4);
            animation: progressPulse 2s ease-in-out infinite;
        }
        @keyframes progressPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 20px rgba(168, 85, 247, 0.6),
                    0 0 40px rgba(236, 72, 153, 0.4);
            }
            50% { 
                box-shadow: 
                    0 0 30px rgba(168, 85, 247, 0.8),
                    0 0 60px rgba(236, 72, 153, 0.6);
            }
        }
        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        .slide-in-left {
            animation: slideInLeft 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .slide-in-right {
            animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .scale-in {
            animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .pulse {
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .celebration {
            animation: celebration 0.8s ease-in-out;
        }
        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-5deg); }
            50% { transform: scale(1.3) rotate(5deg); }
            75% { transform: scale(1.2) rotate(-5deg); }
        }
        .countdown-pulse {
            animation: countdownPulse 1s ease-in-out;
        }
        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); color: #22c55e; }
            50% { transform: scale(1.15); color: #fbbf24; }
        }
        .countdown-urgent {
            animation: countdownUrgent 1s ease-in-out infinite;
        }
        @keyframes countdownUrgent {
            0%, 100% { transform: scale(1); color: #ef4444; text-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { transform: scale(1.2); color: #f97316; text-shadow: 0 0 30px rgba(249, 115, 22, 0.7); }
        }
        .app-shell {
            position: relative;
            background: 
                radial-gradient(ellipse 100% 100% at 50% -30%, rgba(124, 58, 237, 0.25), transparent 60%),
                radial-gradient(ellipse 80% 80% at 0% 100%, rgba(236, 72, 153, 0.15), transparent 60%),
                radial-gradient(ellipse 80% 80% at 100% 100%, rgba(59, 130, 246, 0.15), transparent 60%),
                linear-gradient(180deg, #0f0318 0%, #1a0b2e 50%, #0a0612 100%);
            overflow-x: hidden;
            min-height: 100vh;
            animation: backgroundShift 20s ease-in-out infinite;
        }
        @keyframes backgroundShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(10deg); }
        }
        .app-shell::before {
            content: "";
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(168, 85, 247, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: floatingOrbs 15s ease-in-out infinite;
        }
        @keyframes floatingOrbs {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(20px, -20px) scale(1.05); }
            66% { transform: translate(-20px, 20px) scale(0.95); }
        }
        .app-shell::after {
            content: "";
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, 
                rgba(124, 58, 237, 0.1) 0%, 
                transparent 30%, 
                transparent 70%, 
                rgba(236, 72, 153, 0.1) 100%);
            mix-blend-mode: screen;
            pointer-events: none;
            z-index: 0;
            animation: gradientSlide 12s ease-in-out infinite;
        }
        @keyframes gradientSlide {
            0%, 100% { opacity: 0.6; transform: translateX(0); }
            50% { opacity: 0.8; transform: translateX(10px); }
        }
        .app-main {
            position: relative;
            z-index: 1;
        }
        .app-card {
            position: relative;
            background: linear-gradient(135deg, 
                rgba(30, 20, 50, 0.6) 0%, 
                rgba(20, 15, 35, 0.85) 100%);
            border: 1px solid rgba(168, 85, 247, 0.15);
            box-shadow: 
                0 20px 60px -15px rgba(124, 58, 237, 0.3),
                0 10px 30px -10px rgba(236, 72, 153, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px) saturate(180%);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .app-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, 
                rgba(168, 85, 247, 0.25) 0%, 
                rgba(236, 72, 153, 0.15) 40%, 
                transparent 70%);
            opacity: 0;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        .app-card:hover::before {
            opacity: 1;
        }
        .app-card:hover {
            transform: translateY(-2px);
            border-color: rgba(168, 85, 247, 0.3);
            box-shadow: 
                0 25px 70px -15px rgba(124, 58, 237, 0.4),
                0 15px 40px -10px rgba(236, 72, 153, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        .app-card > * {
            position: relative;
            z-index: 1;
        }
        .gradient-quote {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, 
                #a855f7 0%, 
                #ec4899 50%, 
                #f43f5e 100%);
            box-shadow: 
                0 20px 70px rgba(168, 85, 247, 0.5),
                0 10px 40px rgba(236, 72, 153, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: quoteGlow 4s ease-in-out infinite;
        }
        @keyframes quoteGlow {
            0%, 100% { 
                box-shadow: 
                    0 20px 70px rgba(168, 85, 247, 0.5),
                    0 10px 40px rgba(236, 72, 153, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
            50% { 
                box-shadow: 
                    0 25px 80px rgba(168, 85, 247, 0.6),
                    0 15px 50px rgba(236, 72, 153, 0.5),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4);
            }
        }
        .gradient-quote::before {
            content: "";
            position: absolute;
            inset: -30%;
            background: radial-gradient(circle at 30% 40%, rgba(255, 255, 255, 0.4) 0%, transparent 50%);
            opacity: 0.7;
            filter: blur(25px);
            animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes shimmer {
            0%, 100% { transform: translate(0, 0); opacity: 0.7; }
            50% { transform: translate(10%, -10%); opacity: 0.9; }
        }
        .gradient-quote::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(0, 0, 0, 0.1) 100%);
            pointer-events: none;
        }
        .glass-nav {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(14px);
            border-top: 1px solid rgba(148, 163, 184, 0.15);
            box-shadow: 0 -12px 40px rgba(15, 23, 42, 0.45);
            border-radius: 24px 24px 0 0;
        }
        .glass-nav .nav-btn {
            position: relative;
            color: #9ca3af;
            transition: color 0.3s ease, transform 0.3s ease;
        }
        .glass-nav .nav-btn::after {
            content: "";
            position: absolute;
            inset: 4px 12px;
            border-radius: 9999px;
            background: rgba(59, 130, 246, 0.12);
            opacity: 0;
            transform: translateY(6px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .glass-nav .nav-btn i {
            display: block;
            margin: 0 auto 2px;
        }
        .glass-nav .nav-btn span {
            font-size: 0.6rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .glass-nav .nav-btn.text-blue-500 {
            color: #60a5fa !important;
            transform: translateY(-4px);
        }
        .glass-nav .nav-btn.text-blue-500::after {
            opacity: 1;
            transform: translateY(0);
        }
        #workout-icon {
            box-shadow: 
                0 15px 40px rgba(168, 85, 247, 0.6),
                0 8px 25px rgba(236, 72, 153, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, 
                #a855f7 0%, 
                #ec4899 100%);
            animation: iconFloat 3s ease-in-out infinite;
        }
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(2deg); }
        }
        #workout-card button,
        #complete-set-btn,
        #start-workout-btn,
        #finish-workout-btn,
        #next-exercise-btn,
        #skip-rest-btn,
        #add-time-btn,
        #hiit-start-pause-btn,
        #hiit-reset-btn,
        #go-home-btn {
            position: relative;
            overflow: hidden;
        }
        #workout-card button::before,
        #complete-set-btn::before,
        #start-workout-btn::before,
        #finish-workout-btn::before,
        #next-exercise-btn::before,
        #skip-rest-btn::before,
        #add-time-btn::before,
        #hiit-start-pause-btn::before,
        #hiit-reset-btn::before,
        #go-home-btn::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(255, 255, 255, 0.15), transparent 65%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #workout-card button:hover::before,
        #complete-set-btn:hover::before,
        #start-workout-btn:hover::before,
        #finish-workout-btn:hover::before,
        #next-exercise-btn:hover::before,
        #skip-rest-btn:hover::before,
        #add-time-btn:hover::before,
        #hiit-start-pause-btn:hover::before,
        #hiit-reset-btn:hover::before,
        #go-home-btn:hover::before {
            opacity: 1;
        }
        #exercise-tip {
            border: 1px solid rgba(168, 85, 247, 0.35);
            box-shadow: inset 0 0 25px rgba(168, 85, 247, 0.15);
        }
        #rest-timer {
            text-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
        }
        #hiit-timer {
            text-shadow: 0 10px 40px rgba(249, 115, 22, 0.6);
            animation: timerPulse 2s ease-in-out infinite;
        }
        @keyframes timerPulse {
            0%, 100% { text-shadow: 0 10px 40px rgba(249, 115, 22, 0.6); }
            50% { text-shadow: 0 15px 50px rgba(249, 115, 22, 0.8); }
        }
        #hiit-timer-display {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px rgba(15, 23, 42, 0.5);
        }
        #hiit-status {
            letter-spacing: 0.35em;
        }
        #hiit-round {
            letter-spacing: 0.08em;
            color: rgba(203, 213, 225, 0.9);
        }
        #hiit-timer-display.hiit-idle {
            background: linear-gradient(135deg, 
                rgba(30, 20, 50, 0.7), 
                rgba(20, 15, 35, 0.85));
            border-color: rgba(107, 114, 128, 0.5);
        }
        #hiit-timer-display.hiit-active {
            background: linear-gradient(135deg, 
                rgba(249, 115, 22, 0.3), 
                rgba(239, 68, 68, 0.5));
            border-color: rgba(249, 115, 22, 0.6) !important;
            box-shadow: 
                0 25px 50px rgba(249, 115, 22, 0.4),
                inset 0 0 60px rgba(249, 115, 22, 0.2);
        }
        #hiit-timer-display.hiit-rest {
            background: linear-gradient(135deg, 
                rgba(6, 182, 212, 0.25), 
                rgba(59, 130, 246, 0.35));
            border-color: rgba(6, 182, 212, 0.5) !important;
            box-shadow: 
                0 25px 50px rgba(6, 182, 212, 0.3),
                inset 0 0 60px rgba(6, 182, 212, 0.15);
        }
        #today-screen header h1 {
            letter-spacing: -0.02em;
        }
        #today-screen header p {
            letter-spacing: 0.02em;
        }
        .stat-value {
            font-variant-numeric: tabular-nums;
            font-weight: 800;
            letter-spacing: -0.02em;
        }
        .modern-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.875rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.15));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        .workout-type-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.8);
            animation: pulse-glow 2s ease-in-out infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(168, 85, 247, 0.8);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(236, 72, 153, 1);
                transform: scale(1.2);
            }
        }
        .exercise-card-number {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
            border: 2px solid rgba(15, 23, 42, 0.8);
        }
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        .preview-exercise-item {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
        }
        .preview-exercise-item:hover {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(236, 72, 153, 0.15));
            border-color: rgba(168, 85, 247, 0.3);
            transform: translateX(4px);
        }
    </style>
</head>
<body class="app-shell flex flex-col min-h-screen text-gray-100 antialiased">
    <canvas id="confetti-canvas"></canvas>

    <!-- Main Content -->
    <main class="app-main flex-grow overflow-y-auto pb-24">
        <!-- Today Screen -->
        <div id="today-screen" class="p-6 space-y-6">
            <header class="mb-8">
                <h1 class="text-4xl font-extrabold tracking-tight mb-2 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                    Hello Sai!
                </h1>
                <p class="text-gray-400 text-base font-medium" id="current-date">Let's get stronger today.</p>
            </header>

            <div id="workout-card" class="app-card rounded-3xl p-6 space-y-5 fade-in transition duration-300 transform hover:-translate-y-1 hover:shadow-2xl">
                 <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-4">
                        <div id="workout-icon" class="p-4 rounded-2xl shadow-lg">
                            <!-- Icon will be inserted here -->
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="workout-type-indicator"></span>
                                <p class="text-gray-400 text-xs font-semibold uppercase tracking-wider">Today's Focus</p>
                            </div>
                            <h2 id="workout-title" class="text-3xl font-extrabold mb-1 bg-gradient-to-r from-purple-400 via-pink-400 to-rose-400 bg-clip-text text-transparent">Workout A</h2>
                            <p id="workout-subtitle" class="text-gray-300 text-sm font-semibold">Push & Squat Focus</p>
                            <div class="mt-2">
                                <span id="progress-week-badge" class="modern-badge animate-pulse">Week 1</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Workout Preview - Collapsible -->
                <div id="workout-preview" class="border-t border-white/10 pt-4">
                    <button id="toggle-preview-btn" class="w-full flex items-center justify-between text-left text-gray-300 hover:text-white transition-colors group">
                        <span class="text-sm font-semibold uppercase tracking-wide flex items-center gap-2">
                            <i data-lucide="list" class="w-4 h-4"></i>
                            Exercise Preview
                        </span>
                        <i data-lucide="chevron-down" id="preview-chevron" class="w-5 h-5 transition-transform duration-300"></i>
                    </button>
                    <div id="preview-content" class="hidden mt-3 space-y-2 scale-in">
                        <!-- Exercises will be inserted here -->
                    </div>
                </div>
                
                <button id="start-workout-btn" class="relative w-full bg-gradient-to-r from-purple-600 via-pink-600 to-rose-600 hover:from-purple-700 hover:via-pink-700 hover:to-rose-700 text-white font-bold py-6 rounded-2xl text-xl touch-active transition-all duration-300 shadow-[0_0_40px_rgba(168,85,247,0.5)] hover:shadow-[0_0_60px_rgba(168,85,247,0.7)] transform hover:scale-[1.02] overflow-hidden group">
                    <span class="relative z-10">Start Workout 💪</span>
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-400 via-pink-400 to-rose-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                </button>
            </div>
            
            <div id="rest-day-card" class="app-card rounded-3xl p-8 space-y-5 hidden fade-in transition duration-300 transform hover:-translate-y-1">
                <div class="text-center space-y-4">
                    <div class="flex justify-center">
                        <div class="bg-gradient-to-br from-emerald-500 via-green-500 to-teal-500 p-5 rounded-2xl shadow-[0_0_30px_rgba(16,185,129,0.4)] animate-pulse">
                            <i data-lucide="heart-pulse" class="w-12 h-12"></i>
                        </div>
                    </div>
                    <h2 class="text-4xl font-extrabold bg-gradient-to-r from-emerald-400 via-green-400 to-teal-400 bg-clip-text text-transparent">Rest Day</h2>
                    <p class="text-gray-300 font-semibold text-lg">Your muscles grow when you rest 💤</p>
                </div>
                
                <!-- Recovery Tips -->
                <div class="bg-gradient-to-br from-emerald-500/10 to-green-500/10 border border-emerald-500/30 rounded-2xl p-5 space-y-3">
                    <h3 class="font-bold text-lg text-emerald-400 flex items-center gap-2">
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        Recovery Tips
                    </h3>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-400 mt-0.5">💧</span>
                            <span><strong>Hydration:</strong> Drink 2-3 liters of water today</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-400 mt-0.5">🍗</span>
                            <span><strong>Protein:</strong> Maintain protein intake for muscle repair</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-400 mt-0.5">😴</span>
                            <span><strong>Sleep:</strong> Aim for 7-9 hours of quality sleep</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-emerald-400 mt-0.5">🚶</span>
                            <span><strong>Light Activity:</strong> Walk, stretch, or do yoga</span>
                        </li>
                    </ul>
                </div>
                
                <!-- Next Workout Preview -->
                <div class="bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/30 rounded-2xl p-5">
                    <h3 class="font-bold text-base text-purple-400 mb-2 flex items-center gap-2">
                        <i data-lucide="calendar-check" class="w-4 h-4"></i>
                        Next Workout
                    </h3>
                    <div class="flex items-center justify-between">
                        <div>
                            <p id="next-workout-type" class="text-lg font-bold text-transparent bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text">Workout A</p>
                            <p id="next-workout-day" class="text-xs text-gray-400 font-medium">Monday - Push & Squat</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-600 to-pink-600 p-3 rounded-xl shadow-lg">
                            <i data-lucide="barbell" class="w-6 h-6"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="app-card rounded-3xl p-6 space-y-4 fade-in transition duration-300 transform hover:-translate-y-1">
                <h3 class="font-extrabold text-2xl mb-3 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Your Progress</h3>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center bg-gradient-to-br from-cyan-500/15 to-blue-500/15 rounded-xl p-4 border border-cyan-500/30 backdrop-blur-sm transform hover:scale-105 transition-transform duration-200">
                        <p class="text-4xl font-extrabold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent stat-value mb-1" id="workout-streak">0</p>
                        <p class="text-xs text-gray-300 font-bold uppercase tracking-wide">Day Streak</p>
                    </div>
                    <div class="text-center bg-gradient-to-br from-emerald-500/15 to-green-500/15 rounded-xl p-4 border border-emerald-500/30 backdrop-blur-sm transform hover:scale-105 transition-transform duration-200">
                        <p class="text-4xl font-extrabold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent stat-value mb-1" id="total-workouts">0</p>
                        <p class="text-xs text-gray-300 font-bold uppercase tracking-wide">Workouts</p>
                    </div>
                    <div class="text-center bg-gradient-to-br from-purple-500/15 to-pink-500/15 rounded-xl p-4 border border-purple-500/30 backdrop-blur-sm transform hover:scale-105 transition-transform duration-200">
                        <p class="text-4xl font-extrabold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent stat-value mb-1" id="this-week">0</p>
                        <p class="text-xs text-gray-300 font-bold uppercase tracking-wide">This Week</p>
                    </div>
                </div>
            </div>

            <div class="app-card rounded-3xl p-6 space-y-3 fade-in transition duration-300 transform hover:-translate-y-1">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-xl mb-1">Workout Reminders</h3>
                        <p class="text-gray-400 text-sm font-medium">Get a nudge at 8:00 PM.</p>
                    </div>
                    <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="reminder-toggle" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="reminder-toggle" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                    <style>.toggle-checkbox:checked { right: 0; border-color: #2563EB; } .toggle-checkbox:checked + .toggle-label { background-color: #2563EB; }</style>
                </div>
            </div>
        </div>

        <!-- Workout Screen -->
        <div id="workout-screen" class="hidden p-6 space-y-5">
            <div class="flex items-center justify-between mb-3">
                <button id="back-to-home-btn" class="text-gray-400 hover:text-white touch-active transition-colors p-2 rounded-lg hover:bg-white/5">
                    <i data-lucide="arrow-left"></i>
                </button>
                <p id="progress-text" class="text-xs font-bold uppercase tracking-wider text-gray-300 bg-white/10 border border-white/20 rounded-full px-5 py-2 modern-badge">1 / 8</p>
            </div>
            <div class="flex items-center justify-between">
                <h2 id="current-exercise-title" class="text-3xl font-extrabold">Goblet Squats</h2>
                <button id="exercise-info-btn" class="text-blue-400 hover:text-blue-300 touch-active transition-colors p-2 rounded-lg hover:bg-blue-500/10">
                    <i data-lucide="info"></i>
                </button>
            </div>
            <div class="w-full bg-gray-700/50 rounded-full h-3 backdrop-blur-sm">
                <div id="progress-bar" class="bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full progress-bar-inner shadow-lg" style="width: 10%"></div>
            </div>

            <div class="app-card text-center rounded-3xl p-8 my-4 fade-in transition duration-300 transform hover:-translate-y-1">
                <div id="exercise-tip" class="bg-blue-500/20 border border-blue-500/30 rounded-2xl p-4 mb-5 text-sm text-blue-200 font-medium hidden">
                    <p id="exercise-tip-text"></p>
                </div>
                <p class="text-gray-400 text-base font-semibold uppercase tracking-wider mb-3">Current Set</p>
                <p id="current-set" class="text-7xl font-extrabold my-3 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">1 / 3</p>
                <p id="current-reps" class="text-blue-400 text-xl font-bold">8 - 12 Reps</p>
            </div>

            <button id="complete-set-btn" class="w-full bg-gradient-to-r from-purple-600 via-pink-600 to-rose-600 hover:from-purple-700 hover:via-pink-700 hover:to-rose-700 text-white font-bold py-5 rounded-2xl text-lg touch-active transition-all duration-300 shadow-[0_0_30px_rgba(168,85,247,0.4)] hover:shadow-[0_0_50px_rgba(168,85,247,0.6)] transform hover:scale-[1.02]">Complete Set</button>

            <div id="rest-timer-view" class="app-card hidden text-center fade-in mt-4 p-6 rounded-3xl border-2 border-emerald-500/30">
                <p class="text-base text-emerald-400 font-bold uppercase tracking-wider mb-3 animate-pulse">REST</p>
                <p id="rest-timer" class="text-7xl font-extrabold my-4 text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">60</p>
                
                <!-- Next Exercise Preview -->
                <div id="next-exercise-preview" class="mt-4 mb-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-xl p-4 hidden backdrop-blur-sm scale-in">
                    <p class="text-xs text-gray-300 font-semibold uppercase tracking-wide mb-2">Up Next</p>
                    <p id="next-exercise-name" class="text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-pink-300 font-bold text-base"></p>
                </div>
                
                <div class="flex justify-center gap-3 mt-4">
                    <button id="reduce-time-btn" class="bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white px-4 py-3 rounded-xl touch-active transition-all duration-200 font-semibold shadow-lg">-15s</button>
                    <button id="skip-rest-btn" class="bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-xl touch-active transition-all duration-200 font-semibold shadow-lg">Skip</button>
                    <button id="add-time-btn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-4 py-3 rounded-xl touch-active transition-all duration-200 font-semibold shadow-[0_0_20px_rgba(168,85,247,0.4)]">+15s</button>
                </div>
            </div>
            
            <button id="next-exercise-btn" class="w-full bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 rounded-2xl text-lg touch-active transition-all duration-200 mt-4 hidden shadow-lg transform hover:scale-[1.02]">Next Exercise →</button>
            <button id="finish-workout-btn" class="w-full bg-gradient-to-r from-emerald-600 via-green-600 to-teal-600 hover:from-emerald-700 hover:via-green-700 hover:to-teal-700 text-white font-bold py-5 rounded-2xl text-xl touch-active transition-all duration-300 hidden mt-4 shadow-[0_0_40px_rgba(16,185,129,0.5)] hover:shadow-[0_0_60px_rgba(16,185,129,0.7)] transform hover:scale-[1.02]">Finish Workout ✨</button>
        </div>
        
        <!-- Workout Complete Screen -->
        <div id="workout-complete-screen" class="hidden p-8 flex flex-col items-center justify-center text-center space-y-6 h-full">
            <div class="celebration">
                <i data-lucide="trophy" class="text-yellow-400" size="80"></i>
            </div>
            <h2 class="text-5xl font-extrabold bg-gradient-to-r from-yellow-400 via-orange-400 to-pink-400 bg-clip-text text-transparent">Workout Complete!</h2>
            <p class="text-gray-300 max-w-sm font-medium text-lg">Amazing work. You've pushed your limits. Now remember to refuel with protein and get a good night's sleep.</p>
            <div class="app-card rounded-3xl p-6 max-w-sm w-full mt-4 transition duration-300 transform hover:-translate-y-1">
                <p class="text-sm text-gray-400 mb-4 font-semibold uppercase tracking-wider">Session Summary</p>
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div class="bg-blue-500/10 rounded-xl p-3 border border-blue-500/20">
                        <p class="text-2xl font-extrabold text-blue-400 stat-value mb-1" id="session-exercises">8</p>
                        <p class="text-xs text-gray-400 font-semibold uppercase tracking-wide">Exercises</p>
                    </div>
                    <div class="bg-green-500/10 rounded-xl p-3 border border-green-500/20">
                        <p class="text-2xl font-extrabold text-green-400 stat-value mb-1" id="session-sets">24</p>
                        <p class="text-xs text-gray-400 font-semibold uppercase tracking-wide">Sets</p>
                    </div>
                    <div class="bg-purple-500/10 rounded-xl p-3 border border-purple-500/20">
                        <p class="text-2xl font-extrabold text-purple-400 stat-value mb-1" id="session-duration">0:00</p>
                        <p class="text-xs text-gray-400 font-semibold uppercase tracking-wide">Duration</p>
                    </div>
                </div>
            </div>
            <button id="go-home-btn" class="w-full max-w-sm bg-gradient-to-r from-purple-600 via-pink-600 to-rose-600 hover:from-purple-700 hover:via-pink-700 hover:to-rose-700 text-white font-bold py-5 rounded-2xl text-lg touch-active transition-all duration-300 mt-6 shadow-[0_0_40px_rgba(168,85,247,0.5)] hover:shadow-[0_0_60px_rgba(168,85,247,0.7)] transform hover:scale-[1.02]">Back to Home 🏠</button>
        </div>


        <!-- HIIT Timer Screen -->
        <div id="hiit-screen" class="hidden p-6 flex flex-col h-full space-y-4">
            <div class="text-center mb-2">
                <h2 class="text-4xl font-extrabold mb-2 bg-gradient-to-r from-orange-400 via-red-500 to-pink-500 bg-clip-text text-transparent">HIIT Finisher</h2>
                <p class="text-gray-300 font-semibold text-sm">🔥 15 Minutes to incinerate fat</p>
            </div>
            
            <div id="hiit-timer-display" class="app-card flex flex-col items-center justify-center flex-grow transition-all duration-500 rounded-3xl hiit-idle border-2 border-gray-600/50 relative overflow-hidden">
                 <!-- Animated background circles -->
                 <div class="absolute inset-0 opacity-20">
                     <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full bg-gradient-to-r from-orange-500 to-red-500 blur-3xl animate-pulse"></div>
                 </div>
                 
                 <p id="hiit-status" class="text-3xl font-extrabold tracking-widest uppercase text-gray-300 mb-6 relative z-10">GET READY</p>
                 <p id="hiit-timer" class="text-9xl font-extrabold my-4 relative z-10 tabular-nums">10</p>
                 <p id="hiit-round" class="text-lg text-gray-300 font-semibold mt-4 relative z-10">Round 1 / 10</p>
            </div>
            
            <!-- Volume Control (moved to bottom section) -->
            <div class="app-card rounded-2xl p-4">
                <div class="flex items-center justify-between gap-3 mb-3">
                    <i data-lucide="volume-2" class="text-purple-400 w-5 h-5"></i>
                    <span class="text-sm font-semibold text-gray-300 uppercase tracking-wide">Volume</span>
                    <span id="volume-label" class="text-sm text-purple-400 font-bold">30%</span>
                </div>
                <input type="range" id="hiit-volume" min="0" max="100" value="30" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600">
            </div>
            
            <!-- HIIT Stats/Info Cards -->
            <div class="grid grid-cols-3 gap-3">
                <div class="app-card rounded-xl p-3 text-center">
                    <p class="text-xs text-gray-400 font-semibold uppercase mb-1">Sprint</p>
                    <p class="text-xl font-extrabold text-orange-400">30s</p>
                </div>
                <div class="app-card rounded-xl p-3 text-center">
                    <p class="text-xs text-gray-400 font-semibold uppercase mb-1">Rest</p>
                    <p class="text-xl font-extrabold text-cyan-400">60s</p>
                </div>
                <div class="app-card rounded-xl p-3 text-center">
                    <p class="text-xs text-gray-400 font-semibold uppercase mb-1">Rounds</p>
                    <p class="text-xl font-extrabold text-pink-400">10</p>
                </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4">
                <button id="hiit-reset-btn" class="bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 p-4 rounded-2xl flex justify-center items-center touch-active transition-all duration-200 shadow-lg">
                    <i data-lucide="rotate-cw"></i>
                </button>
                <button id="hiit-start-pause-btn" class="bg-gradient-to-r from-orange-600 via-red-600 to-pink-600 hover:from-orange-700 hover:via-red-700 hover:to-pink-700 col-span-2 p-4 rounded-2xl flex justify-center items-center touch-active text-lg font-bold space-x-2 shadow-[0_0_30px_rgba(249,115,22,0.5)] transition-all duration-200 transform hover:scale-[1.02]">
                    <i data-lucide="play"></i>
                    <span>Start</span>
                </button>
            </div>
        </div>

        <!-- Diet Screen -->
        <div id="diet-screen" class="hidden p-6 space-y-5">
            <div class="mb-4">
                <h2 class="text-3xl font-extrabold mb-2">Diet Protocol</h2>
                <p class="text-gray-400 font-medium">Your diet is fixed, but your discipline isn't. Control what you can control.</p>
            </div>
            
            <div class="space-y-4">
                <div class="app-card p-5 rounded-2xl flex items-start space-x-4 transition duration-300 transform hover:-translate-y-1">
                    <i data-lucide="hand" class="text-blue-400 mt-1 flex-shrink-0"></i>
                    <div>
                        <h3 class="font-bold text-lg mb-1">Portion Control is #1</h3>
                        <p class="text-gray-300 text-sm font-medium">Rice: 1 clenched fist. Veggies: Half your plate. Protein: Palm of your hand.</p>
                    </div>
                </div>
                <div class="app-card p-5 rounded-2xl flex items-start space-x-4 transition duration-300 transform hover:-translate-y-1">
                    <i data-lucide="egg" class="text-yellow-400 mt-1 flex-shrink-0"></i>
                    <div>
                        <h3 class="font-bold text-lg mb-1">Prioritize Protein</h3>
                        <p class="text-gray-300 text-sm font-medium">Eat your chicken/eggs first. Have 2-3 eggs for breakfast daily. Consider a post-workout whey protein shake.</p>
                    </div>
                </div>
                 <div class="app-card p-5 rounded-2xl flex items-start space-x-4 transition duration-300 transform hover:-translate-y-1">
                    <i data-lucide="glass-water" class="text-cyan-400 mt-1 flex-shrink-0"></i>
                    <div>
                        <h3 class="font-bold text-lg mb-1">Hydrate Aggressively</h3>
                        <p class="text-gray-300 text-sm font-medium">Drink a large glass of water before each meal. Aim for 2-3 liters per day.</p>
                    </div>
                </div>
                <div class="app-card p-5 rounded-2xl flex items-start space-x-4 transition duration-300 transform hover:-translate-y-1">
                    <i data-lucide="zap-off" class="text-red-400 mt-1 flex-shrink-0"></i>
                    <div>
                        <h3 class="font-bold text-lg mb-1">Minimize Sauces & Oils</h3>
                        <p class="text-gray-300 text-sm font-medium">Be mindful of hidden calories. If possible, ask for less sauce or drain excess oil.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div id="history-screen" class="hidden p-6 space-y-5">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-3xl font-extrabold">Workout History</h2>
                <button id="clear-history-btn" class="text-red-400 text-sm font-semibold touch-active hover:text-red-300 transition-colors">
                    <i data-lucide="trash-2" class="inline-block w-4 h-4"></i> Clear
                </button>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="app-card rounded-2xl p-4 text-center transition duration-300 transform hover:-translate-y-1 bg-blue-500/10 border border-blue-500/20">
                    <p class="text-3xl font-extrabold text-blue-400 stat-value mb-1" id="history-streak">0</p>
                    <p class="text-xs text-gray-400 mt-1 font-semibold uppercase tracking-wide">Current Streak</p>
                </div>
                <div class="app-card rounded-2xl p-4 text-center transition duration-300 transform hover:-translate-y-1 bg-green-500/10 border border-green-500/20">
                    <p class="text-3xl font-extrabold text-green-400 stat-value mb-1" id="history-total">0</p>
                    <p class="text-xs text-gray-400 mt-1 font-semibold uppercase tracking-wide">Total</p>
                </div>
                <div class="app-card rounded-2xl p-4 text-center transition duration-300 transform hover:-translate-y-1 bg-purple-500/10 border border-purple-500/20">
                    <p class="text-3xl font-extrabold text-purple-400 stat-value mb-1" id="history-month">0</p>
                    <p class="text-xs text-gray-400 mt-1 font-semibold uppercase tracking-wide">This Month</p>
                </div>
            </div>

            <div id="workout-history-list" class="space-y-3">
                <!-- History items will be inserted here -->
            </div>
            
            <div id="empty-history" class="text-center py-12 hidden">
                <i data-lucide="calendar-x" class="mx-auto text-gray-600 mb-3"></i>
                <p class="text-gray-400">No workouts yet. Start your first one today!</p>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="glass-nav fixed bottom-0 left-0 right-0 flex justify-around px-4 py-2 z-20">
        <button data-screen="today-screen" class="nav-btn flex-1 flex flex-col items-center gap-1 py-2 rounded-2xl text-blue-500 transition duration-200">
            <i data-lucide="home"></i>
            <span class="block">Today</span>
        </button>
        <button data-screen="hiit-screen" class="nav-btn flex-1 flex flex-col items-center gap-1 py-2 rounded-2xl text-gray-400 transition duration-200">
            <i data-lucide="timer"></i>
            <span class="block">HIIT Timer</span>
        </button>
        <button data-screen="diet-screen" class="nav-btn flex-1 flex flex-col items-center gap-1 py-2 rounded-2xl text-gray-400 transition duration-200">
            <i data-lucide="utensils-crossed"></i>
            <span class="block">Diet</span>
        </button>
        <button data-screen="history-screen" class="nav-btn flex-1 flex flex-col items-center gap-1 py-2 rounded-2xl text-gray-400 transition duration-200">
            <i data-lucide="calendar-clock"></i>
            <span class="block">History</span>
        </button>
    </nav>
    
    <script>
        // Register the service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // --- All the application JavaScript from the previous step goes here ---
        // (The JS code is identical to the previous version, just the sw.js path is changed above)
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const WORKOUTS = {
                A: { 
                    title: "Workout A", 
                    subtitle: "Push & Squat Focus", 
                    icon: "barbell", 
                    exercises: [
                        { name: "Goblet Squats", sets: 3, reps: "8-12", tip: "Keep chest up, core tight. Drive through heels." }, 
                        { name: "Dumbbell Bench Press", sets: 3, reps: "8-12", tip: "Control the descent. Push explosively up." }, 
                        { name: "Overhead Press", sets: 3, reps: "8-12", tip: "Engage core. Press weight straight overhead." }, 
                        { name: "Lunges", sets: 3, reps: "10-12 per leg", tip: "Keep torso upright. Back knee nearly touches ground." }, 
                        { name: "Tricep Pushdowns", sets: 2, reps: "12-15", tip: "Keep elbows locked at sides. Full extension." }
                    ], 
                    core: [
                        { name: "Plank", sets: 3, reps: "45-60 sec", tip: "Body in straight line. Don't let hips sag." }, 
                        { name: "Lying Leg Raises", sets: 3, reps: "15-20", tip: "Keep lower back pressed to floor. Controlled movement." }, 
                        { name: "Russian Twists", sets: 3, reps: "20 total", tip: "Twist from core, not arms. Keep feet elevated." }
                    ] 
                },
                B: { 
                    title: "Workout B", 
                    subtitle: "Pull & Hinge Focus", 
                    icon: "move-up", 
                    exercises: [
                        { name: "Romanian Deadlifts", sets: 3, reps: "8-12", tip: "Hinge at hips. Keep back straight and core tight." }, 
                        { name: "Lat Pulldowns", sets: 3, reps: "8-12", tip: "Pull to upper chest. Squeeze shoulder blades together." }, 
                        { name: "Bent-Over Rows", sets: 3, reps: "10-12 per arm", tip: "Pull elbow back. Keep core engaged throughout." }, 
                        { name: "Leg Press", sets: 3, reps: "10-15", tip: "Full range of motion. Don't lock knees at top." }, 
                        { name: "Bicep Curls", sets: 2, reps: "12-15", tip: "No swinging. Full contraction at top." }
                    ], 
                    core: [
                        { name: "Plank", sets: 3, reps: "45-60 sec", tip: "Body in straight line. Don't let hips sag." }, 
                        { name: "Lying Leg Raises", sets: 3, reps: "15-20", tip: "Keep lower back pressed to floor. Controlled movement." }, 
                        { name: "Russian Twists", sets: 3, reps: "20 total", tip: "Twist from core, not arms. Keep feet elevated." }
                    ] 
                }
            };

            const MOTIVATIONAL_QUOTES = [
                "Discipline is choosing between what you want now and what you want most.",
                "The only bad workout is the one that didn't happen.",
                "Your body can stand almost anything. It's your mind you have to convince.",
                "Strength doesn't come from what you can do. It comes from overcoming what you couldn't.",
                "The pain you feel today will be the strength you feel tomorrow.",
                "Don't count the days, make the days count.",
                "Success isn't given. It's earned. On the track, on the field, in the gym.",
                "The difference between try and triumph is a little umph.",
                "Push yourself because no one else is going to do it for you.",
                "Great things never come from comfort zones."
            ];

            let state = { 
                currentScreen: 'today-screen', 
                lastWorkoutType: localStorage.getItem('lastWorkoutType') || 'B', 
                lastWorkoutDate: localStorage.getItem('lastWorkoutDate') || '', 
                todaysWorkout: null, 
                workoutInProgress: false, 
                currentExerciseIndex: 0, 
                currentSet: 1, 
                restTimerInterval: null,
                restTimeLeft: 60,
                remindersEnabled: JSON.parse(localStorage.getItem('remindersEnabled')) || false,
                workoutHistory: JSON.parse(localStorage.getItem('workoutHistory')) || [],
                showExerciseTip: false,
                workoutStartTime: null,
                workoutDuration: 0,
                startWeek: localStorage.getItem('startWeek') || null,
                wakeLock: null
            };
            let hiitState = { 
                timer: null, 
                running: false, 
                mode: 'prep', 
                timeLeft: 10, 
                totalRounds: 10, 
                currentRound: 1, 
                sprintDuration: 30, 
                restDuration: 60, 
                prepDuration: 10,
                volume: parseFloat(localStorage.getItem('hiitVolume')) || 0.3
            };
            
            const screens = document.querySelectorAll('main > div');
            const navBtns = document.querySelectorAll('.nav-btn');
            const goHomeBtn = document.getElementById('go-home-btn');
            const currentDateEl = document.getElementById('current-date');
            const workoutCard = document.getElementById('workout-card');
            const restDayCard = document.getElementById('rest-day-card');
            const workoutTitle = document.getElementById('workout-title');
            const workoutSubtitle = document.getElementById('workout-subtitle');
            const workoutIconContainer = document.getElementById('workout-icon');
            const startWorkoutBtn = document.getElementById('start-workout-btn');
            const togglePreviewBtn = document.getElementById('toggle-preview-btn');
            const previewContent = document.getElementById('preview-content');
            const previewChevron = document.getElementById('preview-chevron');
            const reminderToggle = document.getElementById('reminder-toggle');
            const currentExerciseTitle = document.getElementById('current-exercise-title');
            const progressText = document.getElementById('progress-text');
            const progressBar = document.getElementById('progress-bar');
            const currentSetEl = document.getElementById('current-set');
            const currentRepsEl = document.getElementById('current-reps');
            const completeSetBtn = document.getElementById('complete-set-btn');
            const restTimerView = document.getElementById('rest-timer-view');
            const restTimerEl = document.getElementById('rest-timer');
            const skipRestBtn = document.getElementById('skip-rest-btn');
            const nextExerciseBtn = document.getElementById('next-exercise-btn');
            const finishWorkoutBtn = document.getElementById('finish-workout-btn');
            const hiitTimerDisplay = document.getElementById('hiit-timer-display');
            const hiitStatusEl = document.getElementById('hiit-status');
            const hiitTimerEl = document.getElementById('hiit-timer');
            const hiitRoundEl = document.getElementById('hiit-round');
            const hiitStartPauseBtn = document.getElementById('hiit-start-pause-btn');
            const hiitResetBtn = document.getElementById('hiit-reset-btn');
            const hiitVolumeSlider = document.getElementById('hiit-volume');
            const volumeLabel = document.getElementById('volume-label');
            const nextExercisePreview = document.getElementById('next-exercise-preview');
            const nextExerciseName = document.getElementById('next-exercise-name');
            const reduceTimeBtn = document.getElementById('reduce-time-btn');
            const sessionDurationEl = document.getElementById('session-duration');
            const progressWeekBadge = document.getElementById('progress-week-badge');
            const backToHomeBtn = document.getElementById('back-to-home-btn');
            const exerciseInfoBtn = document.getElementById('exercise-info-btn');
            const exerciseTip = document.getElementById('exercise-tip');
            const exerciseTipText = document.getElementById('exercise-tip-text');
            const motivationalQuote = document.getElementById('motivational-quote');
            const workoutStreakEl = document.getElementById('workout-streak');
            const totalWorkoutsEl = document.getElementById('total-workouts');
            const thisWeekEl = document.getElementById('this-week');
            const historyStreakEl = document.getElementById('history-streak');
            const historyTotalEl = document.getElementById('history-total');
            const historyMonthEl = document.getElementById('history-month');
            const workoutHistoryList = document.getElementById('workout-history-list');
            const emptyHistory = document.getElementById('empty-history');
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            const addTimeBtn = document.getElementById('add-time-btn');
            const sessionExercisesEl = document.getElementById('session-exercises');
            const sessionSetsEl = document.getElementById('session-sets');
            
            // Calculate weeks since start for progressive overload
            function getWeeksSinceStart() {
                if (!state.startWeek) {
                    const now = new Date();
                    state.startWeek = now.toISOString().slice(0, 10);
                    localStorage.setItem('startWeek', state.startWeek);
                    return 0;
                }
                const start = new Date(state.startWeek);
                const now = new Date();
                const diffTime = Math.abs(now - start);
                const diffWeeks = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7));
                return diffWeeks;
            }

            // Apply progressive overload to reps
            function getProgressiveReps(baseReps) {
                const weeks = getWeeksSinceStart();
                const match = baseReps.match(/(\d+)-(\d+)/);
                if (match) {
                    const min = parseInt(match[1]) + weeks;
                    const max = parseInt(match[2]) + weeks;
                    return `${min}-${max}`;
                }
                // Handle "X per leg/arm" format
                const perLegMatch = baseReps.match(/(\d+)-(\d+)\s+per\s+(leg|arm)/);
                if (perLegMatch) {
                    const min = parseInt(perLegMatch[1]) + weeks;
                    const max = parseInt(perLegMatch[2]) + weeks;
                    return `${min}-${max} per ${perLegMatch[3]}`;
                }
                // Handle time-based (seconds)
                const timeMatch = baseReps.match(/(\d+)-(\d+)\s+sec/);
                if (timeMatch) {
                    const min = parseInt(timeMatch[1]) + (weeks * 5);
                    const max = parseInt(timeMatch[2]) + (weeks * 5);
                    return `${min}-${max} sec`;
                }
                return baseReps;
            }

            function determineTodaysWorkout() {
                const today = new Date().toISOString().slice(0, 10);
                const todayDay = new Date().getDay();
                if (state.lastWorkoutDate === today) return null;
                const isWorkoutDay = [1, 3, 5].includes(todayDay);
                if (!isWorkoutDay) return null;
                const nextType = state.lastWorkoutType === 'A' ? 'B' : 'A';
                return WORKOUTS[nextType];
            }

            function showScreen(screenId) {
                screens.forEach(screen => screen.classList.toggle('hidden', screen.id !== screenId));
                navBtns.forEach(btn => {
                    const isActive = btn.dataset.screen === screenId;
                    btn.classList.toggle('text-blue-500', isActive);
                    btn.classList.toggle('text-gray-400', !isActive);
                });
                state.currentScreen = screenId;
                
                // Refresh history when viewing history screen
                if (screenId === 'history-screen') {
                    calculateStats();
                    renderHistory();
                }
            }

            async function requestWakeLock() {
                try {
                    if ('wakeLock' in navigator) {
                        state.wakeLock = await navigator.wakeLock.request('screen');
                        console.log('Wake Lock activated');
                    }
                } catch (err) {
                    console.log('Wake Lock error:', err);
                }
            }

            function releaseWakeLock() {
                if (state.wakeLock) {
                    state.wakeLock.release();
                    state.wakeLock = null;
                    console.log('Wake Lock released');
                }
            }

            function startWorkout() {
                state.workoutInProgress = true;
                state.currentExerciseIndex = 0;
                state.currentSet = 1;
                state.workoutStartTime = Date.now();
                requestWakeLock();
                renderCurrentExercise();
                showScreen('workout-screen');
            }

            function renderCurrentExercise() {
                const workout = state.todaysWorkout;
                const fullWorkoutList = [...workout.exercises, ...workout.core];
                if (state.currentExerciseIndex >= fullWorkoutList.length) {
                    finishWorkout();
                    return;
                }
                const exercise = fullWorkoutList[state.currentExerciseIndex];
                const isCore = state.currentExerciseIndex >= workout.exercises.length;
                const progressiveReps = getProgressiveReps(exercise.reps);
                
                currentExerciseTitle.textContent = exercise.name + (isCore ? " (Core)" : "");
                currentRepsEl.textContent = `${progressiveReps} Reps`;
                currentSetEl.textContent = `${state.currentSet} / ${exercise.sets}`;
                const progress = (state.currentExerciseIndex + 1) / fullWorkoutList.length;
                progressBar.style.width = `${progress * 100}%`;
                progressText.textContent = `${state.currentExerciseIndex + 1} / ${fullWorkoutList.length}`;
                completeSetBtn.classList.remove('hidden');
                restTimerView.classList.add('hidden');
                nextExerciseBtn.classList.add('hidden');
                finishWorkoutBtn.classList.add('hidden');
                
                // Show/hide exercise tip
                if (state.showExerciseTip && exercise.tip) {
                    exerciseTip.classList.remove('hidden');
                    exerciseTipText.textContent = exercise.tip;
                } else {
                    exerciseTip.classList.add('hidden');
                }
                
                // Haptic feedback
                if ('vibrate' in navigator) {
                    navigator.vibrate(50);
                }
            }

            function handleCompleteSet() {
                const workout = state.todaysWorkout;
                const fullWorkoutList = [...workout.exercises, ...workout.core];
                const exercise = fullWorkoutList[state.currentExerciseIndex];
                
                // Visual feedback
                completeSetBtn.classList.add('shake');
                setTimeout(() => completeSetBtn.classList.remove('shake'), 500);
                
                if (state.currentSet < exercise.sets) {
                    state.currentSet++;
                    startRestTimer();
                } else {
                    if (state.currentExerciseIndex < fullWorkoutList.length - 1) {
                        nextExerciseBtn.classList.remove('hidden');
                    } else {
                        finishWorkoutBtn.classList.remove('hidden');
                    }
                    completeSetBtn.classList.add('hidden');
                }
            }

            function handleNextExercise() {
                state.currentExerciseIndex++;
                state.currentSet = 1;
                renderCurrentExercise();
            }

            function startRestTimer(duration = 60) {
                completeSetBtn.classList.add('hidden');
                restTimerView.classList.remove('hidden');
                state.restTimeLeft = duration;
                restTimerEl.textContent = state.restTimeLeft;
                
                // Show next exercise preview if available
                const workout = state.todaysWorkout;
                const fullWorkoutList = [...workout.exercises, ...workout.core];
                if (state.currentExerciseIndex < fullWorkoutList.length) {
                    const nextEx = fullWorkoutList[state.currentExerciseIndex];
                    const isCore = state.currentExerciseIndex >= workout.exercises.length;
                    nextExerciseName.textContent = nextEx.name + (isCore ? " (Core)" : "");
                    nextExercisePreview.classList.remove('hidden');
                } else {
                    nextExercisePreview.classList.add('hidden');
                }
                
                clearInterval(state.restTimerInterval);
                state.restTimerInterval = setInterval(() => {
                    state.restTimeLeft--;
                    restTimerEl.textContent = state.restTimeLeft;
                    
                    // Visual feedback for last 3 seconds
                    restTimerEl.classList.remove('countdown-pulse', 'countdown-urgent');
                    if (state.restTimeLeft === 3) {
                        restTimerEl.classList.add('countdown-pulse');
                        if ('vibrate' in navigator) navigator.vibrate(100);
                        playBeep(1);
                    } else if (state.restTimeLeft <= 2 && state.restTimeLeft > 0) {
                        restTimerEl.classList.add('countdown-urgent');
                        if ('vibrate' in navigator) navigator.vibrate(100);
                        playBeep(1);
                    }
                    
                    if (state.restTimeLeft <= 0) {
                        clearInterval(state.restTimerInterval);
                        restTimerEl.classList.remove('countdown-pulse', 'countdown-urgent');
                        restTimerView.classList.add('hidden');
                        if ('vibrate' in navigator) navigator.vibrate([100, 50, 100]);
                        playBeep(2);
                        renderCurrentExercise(); // Auto-advance
                    }
                }, 1000);
            }

            function addRestTime() {
                state.restTimeLeft += 15;
                restTimerEl.textContent = state.restTimeLeft;
                restTimerEl.classList.remove('countdown-pulse', 'countdown-urgent');
                addTimeBtn.classList.add('pulse');
                setTimeout(() => addTimeBtn.classList.remove('pulse'), 500);
                if ('vibrate' in navigator) navigator.vibrate(50);
            }

            function reduceRestTime() {
                state.restTimeLeft = Math.max(0, state.restTimeLeft - 15);
                restTimerEl.textContent = state.restTimeLeft;
                restTimerEl.classList.remove('countdown-pulse', 'countdown-urgent');
                reduceTimeBtn.classList.add('pulse');
                setTimeout(() => reduceTimeBtn.classList.remove('pulse'), 500);
                if ('vibrate' in navigator) navigator.vibrate(50);
            }

            function skipRest() {
                clearInterval(state.restTimerInterval);
                restTimerEl.classList.remove('countdown-pulse', 'countdown-urgent');
                restTimerView.classList.add('hidden');
                if ('vibrate' in navigator) navigator.vibrate(50);
                renderCurrentExercise();
            }

            function finishWorkout() {
                state.workoutInProgress = false;
                releaseWakeLock();
                
                state.lastWorkoutType = state.todaysWorkout === WORKOUTS.A ? 'A' : 'B';
                state.lastWorkoutDate = new Date().toISOString().slice(0, 10);
                localStorage.setItem('lastWorkoutType', state.lastWorkoutType);
                localStorage.setItem('lastWorkoutDate', state.lastWorkoutDate);
                
                // Calculate workout duration
                if (state.workoutStartTime) {
                    state.workoutDuration = Math.floor((Date.now() - state.workoutStartTime) / 1000 / 60);
                    const minutes = state.workoutDuration;
                    const hours = Math.floor(minutes / 60);
                    const mins = minutes % 60;
                    sessionDurationEl.textContent = hours > 0 ? `${hours}h ${mins}m` : `${mins}m`;
                }
                
                // Calculate session stats
                const workout = state.todaysWorkout;
                const totalExercises = workout.exercises.length + workout.core.length;
                const totalSets = [...workout.exercises, ...workout.core].reduce((sum, ex) => sum + ex.sets, 0);
                sessionExercisesEl.textContent = totalExercises;
                sessionSetsEl.textContent = totalSets;
                
                // Haptic feedback
                if ('vibrate' in navigator) {
                    navigator.vibrate([200, 100, 200, 100, 400]);
                }
                
                // Save workout to history
                state.workoutHistory.push({
                    type: state.lastWorkoutType,
                    date: state.lastWorkoutDate,
                    timestamp: new Date().getTime()
                });
                localStorage.setItem('workoutHistory', JSON.stringify(state.workoutHistory));
                
                showScreen('workout-complete-screen');
                
                // Trigger confetti celebration
                createConfetti();
            }

            function setupReminders() {
                reminderToggle.checked = state.remindersEnabled;
            }

            function handleReminderToggle() {
                state.remindersEnabled = reminderToggle.checked;
                localStorage.setItem('remindersEnabled', state.remindersEnabled);
                if (state.remindersEnabled && Notification.permission !== "granted") {
                    Notification.requestPermission();
                }
            }

            function scheduleReminder() {
                if (!state.remindersEnabled || Notification.permission !== 'granted' || !state.todaysWorkout) return;
                const now = new Date();
                const reminderTime = new Date();
                reminderTime.setHours(20, 0, 0, 0); // 8:00 PM
                if (now < reminderTime) {
                    const timeout = reminderTime.getTime() - now.getTime();
                    setTimeout(() => { 
                        const notification = new Notification("Time to Train!", { 
                            body: `Let's crush ${state.todaysWorkout.title} today. You've got this!`,
                            tag: 'workout-reminder',
                            requireInteraction: false
                        });
                        notification.onclick = function() {
                            window.focus();
                            startWorkout();
                            notification.close();
                        };
                    }, timeout);
                }
            }

            function updateHiitUI() {
                hiitTimerEl.textContent = hiitState.timeLeft;
                hiitRoundEl.textContent = `Round ${hiitState.currentRound} / ${hiitState.totalRounds}`;
                hiitStartPauseBtn.innerHTML = hiitState.running ? `<i data-lucide="pause"></i><span>Pause</span>` : `<i data-lucide="play"></i><span>Start</span>`;
                lucide.createIcons();
                let modeClass = 'hiit-idle';
                if (hiitState.mode === 'sprint') modeClass = 'hiit-active';
                if (hiitState.mode === 'rest') modeClass = 'hiit-rest';
                hiitTimerDisplay.className = `app-card flex flex-col items-center justify-center flex-grow transition-colors duration-500 rounded-2xl ${modeClass}`;
                hiitStatusEl.textContent = hiitState.mode === 'prep' ? 'GET READY' : hiitState.mode.toUpperCase() + '!';
            }

            function playBeep(count = 1) {
                // Simple audio feedback using Web Audio API with volume control
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const volume = hiitState.volume;
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        oscillator.frequency.value = count > 1 ? 880 : 440;
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.1);
                    }, i * 150);
                }
            }

            function updateVolume() {
                hiitState.volume = parseFloat(hiitVolumeSlider.value) / 100;
                volumeLabel.textContent = hiitVolumeSlider.value + '%';
                localStorage.setItem('hiitVolume', hiitState.volume);
            }

            function hiitTick() {
                hiitState.timeLeft--;
                
                // Sound notifications
                if (hiitState.timeLeft === 3) {
                    playBeep(1);
                    hiitTimerEl.classList.add('pulse');
                } else if (hiitState.timeLeft === 0) {
                    playBeep(2);
                    hiitTimerEl.classList.remove('pulse');
                }
                
                if (hiitState.timeLeft < 0) {
                    switch(hiitState.mode) {
                        case 'prep': hiitState.mode = 'sprint'; hiitState.timeLeft = hiitState.sprintDuration; break;
                        case 'sprint': hiitState.mode = 'rest'; hiitState.timeLeft = hiitState.restDuration; break;
                        case 'rest':
                            hiitState.currentRound++;
                            if (hiitState.currentRound > hiitState.totalRounds) { 
                                playBeep(3);
                                resetHiit(); 
                                return; 
                            }
                            hiitState.mode = 'sprint'; hiitState.timeLeft = hiitState.sprintDuration; break;
                    }
                }
                updateHiitUI();
            }

            function toggleHiit() {
                hiitState.running = !hiitState.running;
                if (hiitState.running) {
                    hiitState.timer = setInterval(hiitTick, 1000);
                } else {
                    clearInterval(hiitState.timer);
                }
                updateHiitUI();
            }

            function resetHiit() {
                clearInterval(hiitState.timer);
                hiitState.running = false;
                hiitState.mode = 'prep';
                hiitState.timeLeft = hiitState.prepDuration;
                hiitState.currentRound = 1;
                updateHiitUI();
            }

            function calculateStats() {
                const now = new Date();
                const history = state.workoutHistory;
                
                // Total workouts
                const total = history.length;
                totalWorkoutsEl.textContent = total;
                if (historyTotalEl) historyTotalEl.textContent = total;
                
                // This week's workouts
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay());
                startOfWeek.setHours(0, 0, 0, 0);
                const thisWeek = history.filter(w => new Date(w.date) >= startOfWeek).length;
                thisWeekEl.textContent = thisWeek;
                
                // This month's workouts
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const thisMonth = history.filter(w => new Date(w.date) >= startOfMonth).length;
                if (historyMonthEl) historyMonthEl.textContent = thisMonth;
                
                // Streak calculation
                let streak = 0;
                const sortedHistory = [...history].sort((a, b) => new Date(b.date) - new Date(a.date));
                let checkDate = new Date();
                checkDate.setHours(0, 0, 0, 0);
                
                for (let i = 0; i < sortedHistory.length; i++) {
                    const workoutDate = new Date(sortedHistory[i].date);
                    workoutDate.setHours(0, 0, 0, 0);
                    
                    // Check if workout is on a valid workout day (M/W/F = 1/3/5)
                    while (checkDate.getDay() !== 1 && checkDate.getDay() !== 3 && checkDate.getDay() !== 5) {
                        checkDate.setDate(checkDate.getDate() - 1);
                    }
                    
                    if (workoutDate.getTime() === checkDate.getTime()) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 2); // Move to next potential workout day
                    } else {
                        break;
                    }
                }
                workoutStreakEl.textContent = streak;
                if (historyStreakEl) historyStreakEl.textContent = streak;
            }

            function renderHistory() {
                const history = state.workoutHistory;
                
                if (history.length === 0) {
                    emptyHistory.classList.remove('hidden');
                    workoutHistoryList.innerHTML = '';
                    return;
                }
                
                emptyHistory.classList.add('hidden');
                
                // Sort by date descending (newest first)
                const sortedHistory = [...history].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                workoutHistoryList.innerHTML = sortedHistory.map((workout, index) => {
                    const date = new Date(workout.date);
                    const isToday = date.toISOString().slice(0, 10) === new Date().toISOString().slice(0, 10);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    const workoutInfo = WORKOUTS[workout.type];
                    
                    return `
                        <div class="app-card rounded-xl p-4 flex items-center justify-between fade-in transition duration-300 transform hover:-translate-y-1">
                            <div class="flex items-center space-x-4">
                                <div class="bg-${workout.type === 'A' ? 'blue' : 'purple'}-600 p-3 rounded-lg">
                                    <i data-lucide="${workoutInfo.icon}" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold">${workoutInfo.title}${isToday ? ' 🔥' : ''}</h3>
                                    <p class="text-sm text-gray-400">${dayName}, ${dateStr}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-500">${workoutInfo.exercises.length + workoutInfo.core.length} exercises</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Reinitialize lucide icons after adding new HTML
                lucide.createIcons();
            }

            function clearHistory() {
                if (confirm('Are you sure you want to clear all workout history? This cannot be undone.')) {
                    state.workoutHistory = [];
                    localStorage.setItem('workoutHistory', JSON.stringify([]));
                    calculateStats();
                    renderHistory();
                }
            }

            // Confetti Animation
            function createConfetti() {
                const canvas = document.getElementById('confetti-canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const confettiPieces = [];
                const colors = ['#a855f7', '#ec4899', '#f43f5e', '#10b981', '#06b6d4', '#f59e0b'];
                
                for (let i = 0; i < 150; i++) {
                    confettiPieces.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height - canvas.height,
                        rotation: Math.random() * 360,
                        rotationSpeed: Math.random() * 10 - 5,
                        speed: Math.random() * 3 + 2,
                        size: Math.random() * 8 + 4,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        swing: Math.random() * 2 - 1
                    });
                }
                
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    let stillAnimating = false;
                    
                    confettiPieces.forEach(piece => {
                        piece.y += piece.speed;
                        piece.x += piece.swing;
                        piece.rotation += piece.rotationSpeed;
                        
                        if (piece.y < canvas.height) {
                            stillAnimating = true;
                            ctx.save();
                            ctx.translate(piece.x, piece.y);
                            ctx.rotate(piece.rotation * Math.PI / 180);
                            ctx.fillStyle = piece.color;
                            ctx.fillRect(-piece.size / 2, -piece.size / 2, piece.size, piece.size);
                            ctx.restore();
                        }
                    });
                    
                    if (stillAnimating) {
                        requestAnimationFrame(animate);
                    } else {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                }
                
                animate();
            }

            // Workout Preview Toggle
            function toggleWorkoutPreview() {
                const previewContent = document.getElementById('preview-content');
                const chevron = document.getElementById('preview-chevron');
                
                if (previewContent.classList.contains('hidden')) {
                    previewContent.classList.remove('hidden');
                    chevron.style.transform = 'rotate(180deg)';
                } else {
                    previewContent.classList.add('hidden');
                    chevron.style.transform = 'rotate(0deg)';
                }
            }

            // Render Workout Preview
            function renderWorkoutPreview() {
                const previewContent = document.getElementById('preview-content');
                const workout = state.todaysWorkout;
                
                if (!workout) return;
                
                const allExercises = [...workout.exercises, ...workout.core];
                const exerciseIcons = {
                    'Squat': 'activity',
                    'Press': 'move-up',
                    'Push': 'arrow-up-circle',
                    'Pull': 'arrow-down-circle',
                    'Deadlift': 'trending-up',
                    'Row': 'move-horizontal',
                    'Curl': 'circle-dot',
                    'Lunge': 'footprints',
                    'Plank': 'minus',
                    'Leg Raise': 'arrow-up',
                    'Twist': 'rotate-cw'
                };
                
                const getExerciseIcon = (name) => {
                    for (const [key, icon] of Object.entries(exerciseIcons)) {
                        if (name.includes(key)) return icon;
                    }
                    return 'dumbbell';
                };
                
                previewContent.innerHTML = allExercises.map((ex, idx) => {
                    const isCore = idx >= workout.exercises.length;
                    const progressiveReps = getProgressiveReps(ex.reps);
                    return `
                        <div class="preview-exercise-item">
                            <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center shadow-lg">
                                <i data-lucide="${getExerciseIcon(ex.name)}" class="w-5 h-5"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-bold text-white">${ex.name}${isCore ? ' (Core)' : ''}</p>
                                <p class="text-xs text-gray-400">${ex.sets} sets × ${progressiveReps}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                lucide.createIcons();
            }

            // Calculate next workout for rest day
            function calculateNextWorkout() {
                const today = new Date();
                const nextWorkoutDays = [1, 3, 5]; // M, W, F
                let daysToAdd = 1;
                let nextDay = new Date(today);
                
                while (daysToAdd <= 7) {
                    nextDay.setDate(today.getDate() + daysToAdd);
                    if (nextWorkoutDays.includes(nextDay.getDay())) {
                        break;
                    }
                    daysToAdd++;
                }
                
                const nextType = state.lastWorkoutType === 'A' ? 'B' : 'A';
                const nextWorkout = WORKOUTS[nextType];
                
                const nextWorkoutTypeEl = document.getElementById('next-workout-type');
                const nextWorkoutDayEl = document.getElementById('next-workout-day');
                
                if (nextWorkoutTypeEl && nextWorkoutDayEl) {
                    nextWorkoutTypeEl.textContent = nextWorkout.title;
                    const dayName = nextDay.toLocaleDateString('en-US', { weekday: 'long' });
                    nextWorkoutDayEl.textContent = `${dayName} - ${nextWorkout.subtitle}`;
                }
            }

            function init() {
                currentDateEl.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                state.todaysWorkout = determineTodaysWorkout();
                
                // Display random motivational quote
                const randomQuote = MOTIVATIONAL_QUOTES[Math.floor(Math.random() * MOTIVATIONAL_QUOTES.length)];
                motivationalQuote.textContent = `"${randomQuote}"`;
                
                // Initialize HIIT volume slider
                hiitVolumeSlider.value = hiitState.volume * 100;
                volumeLabel.textContent = Math.round(hiitState.volume * 100) + '%';
                
                // Calculate and display stats
                calculateStats();
                
                if (state.todaysWorkout) {
                    workoutCard.classList.remove('hidden');
                    restDayCard.classList.add('hidden');
                    workoutTitle.textContent = state.todaysWorkout.title;
                    workoutSubtitle.textContent = state.todaysWorkout.subtitle;
                    workoutIconContainer.innerHTML = `<i data-lucide="${state.todaysWorkout.icon}"></i>`;
                    
                    // Show progressive overload week
                    const currentWeek = getWeeksSinceStart() + 1;
                    if (progressWeekBadge) {
                        progressWeekBadge.textContent = `Week ${currentWeek} 💪`;
                        progressWeekBadge.title = `You've been training for ${currentWeek} week${currentWeek > 1 ? 's' : ''}! Reps increase by +${getWeeksSinceStart()} this week.`;
                    }
                    
                    // Render workout preview
                    renderWorkoutPreview();
                    
                    lucide.createIcons();
                } else {
                    workoutCard.classList.add('hidden');
                    restDayCard.classList.remove('hidden');
                    
                    // Calculate and show next workout
                    calculateNextWorkout();
                }
                setupReminders();
                scheduleReminder();
                resetHiit();
                showScreen('today-screen');
            }

            function attachEventListeners() {
                navBtns.forEach(btn => btn.addEventListener('click', () => showScreen(btn.dataset.screen)));
                goHomeBtn.addEventListener('click', () => {
                    init();
                    showScreen('today-screen');
                });
                startWorkoutBtn.addEventListener('click', startWorkout);
                togglePreviewBtn.addEventListener('click', toggleWorkoutPreview);
                reminderToggle.addEventListener('change', handleReminderToggle);
                completeSetBtn.addEventListener('click', handleCompleteSet);
                nextExerciseBtn.addEventListener('click', handleNextExercise);
                finishWorkoutBtn.addEventListener('click', finishWorkout);
                skipRestBtn.addEventListener('click', skipRest);
                reduceTimeBtn.addEventListener('click', reduceRestTime);
                addTimeBtn.addEventListener('click', addRestTime);
                hiitStartPauseBtn.addEventListener('click', toggleHiit);
                hiitResetBtn.addEventListener('click', resetHiit);
                hiitVolumeSlider.addEventListener('input', updateVolume);
                backToHomeBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to quit this workout?')) {
                        state.workoutInProgress = false;
                        releaseWakeLock();
                        clearInterval(state.restTimerInterval);
                        init();
                        showScreen('today-screen');
                    }
                });
                exerciseInfoBtn.addEventListener('click', () => {
                    state.showExerciseTip = !state.showExerciseTip;
                    renderCurrentExercise();
                });
                clearHistoryBtn.addEventListener('click', clearHistory);
            }

            attachEventListeners();
            init();
        });
    </script>
</body>
</html>
